<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buddhaword</title>

  <!-- Load Facebook SDK -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v10.0"
    nonce=""></script>

  <!-- Meta -->
  <meta name='description' content='The Word of Buddha' />
  <meta name='keywords'
    content='Buddhaword, ຄຳສອນພຣະພຸດທະເຈົ้າ, ທັມມະ, ທັມມະຊາດ, lao, laos, the word of buddha, buddha, nature' />
  <link rel="manifest" href="/manifest.json" />

  <!-- Open Graph Metadata (for social cards) -->
  <meta property='og:title' content='Buddhaword | The Word of Buddha' />
  <meta property='og:description' content='ຄຳສອນພຣະພຸດທະເຈົ้າ' />
  <meta property='og:image' content='https://sutra.web.app/images/logo.png' />
  <meta property='og:type' content='website' />
  <meta property='og:url' content='https://sutra.web.app' />

  <!-- Twitter Meta Tags -->
  <meta name='twitter:card' content='summary_large_image' />
  <meta name='twitter:title' content='Buddhaword' />
  <meta name='twitter:description' content='The Word of Buddha' />
  <meta name='twitter:image' content='https://sutra.web.app/images/logo.png' />

  <!-- Add the favicon -->
  <link rel="icon" type="image/png" href="/images/logo.png" />

  <!-- PWA Support -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#FFAF5D" />
  <meta name="apple-mobile-web-app-title" content="Buddha-Nature" />
  <meta name="theme-color" content="#FFAF5D" />
  <link rel="apple-touch-icon" href="/images/logo.png" />

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Buddhaword",
    "url": "https://sutra.web.app",
    "description": "ຄຳສອນພຣະພຸດທະເຈົ้າ",
    "publisher": {
      "@type": "Organization",
      "name": "Buddhaword",
      "url": "https://sutra.web.app",
      "logo": {
        "@type": "ImageObject",
        "url": "https://sutra.web.app/images/logo.png"
      }
    }
  }
  </script>

  <!-- Scroll View Style Reset -->
  <style>
    /* Ensure the body does not block overlays */
    body {
      margin: 0;
      padding: 0;
    }

    /* Make overlay banners always the top-most layer */
    /* Inside global CSS or inline styles */
    .install-alert {
      z-index: 9999;
      /* Ensure it's the topmost layer */
      position: fixed;
      /* Anchor it to the viewport */
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      /* Prevent overlapping */
      pointer-events: auto;
      /* Ensure interactions */
    }

    .modal {
      position: fixed;
      /* Sticks to viewport */
      z-index: 9999;
      /* Topmost layer */
      /* Ensures nothing overlaps these elements */
    }

    /* Ensure interactive buttons are clickable */
    .install-alert *,
    .modal * {
      pointer-events: auto;
      /* Allow interaction */
    }

    /* Prevent background content from interfering */
    .install-alert-blocker,
    .modal-blocker {
      pointer-events: none;
      /* Block clicks to underlying layers */
    }

    .sticky-element {
      position: sticky;
      z-index: 999;
    }
  </style>

  <!-- Register Service Worker and Add to Home Screen scripts -->
  <script>
    if ('serviceWorker' in navigator) {
      // Register the service worker
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/sw.js')
          .then((registration) => {
            console.log('Service Worker registered successfully with scope:', registration.scope);
          })
          .catch((error) => {
            console.error('Service Worker registration failed:', error);
          });
      });

      let deferredPrompt; // To handle the "Add to Home Screen" prompt

      // Listen for beforeinstallprompt to show custom prompt
      window.addEventListener('beforeinstallprompt', (event) => {
        console.log('Detected beforeinstallprompt event');

        // Prevent the default install prompt
        event.preventDefault();
        deferredPrompt = event;

        // Show the custom install banner if not shown already
        const hasShownA2HS = localStorage.getItem('hasShownA2HS') === 'true';
        if (!hasShownA2HS) {
          const installAlert = document.createElement('div');
          installAlert.style.cssText = `
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background-color: #ffffff;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
          border-radius: 12px;
          padding: 15px 20px;
          z-index: 999;
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 95%;
          max-width: 400px;
          font-family: Arial, sans-serif;
        `;

          installAlert.innerHTML = `
          <div style="flex: 1;">
            <p style="margin: 0; font-size: 16px; font-weight: bold; color: #333;">
              Add to Home Screen
            </p>
            <p style="margin: 0; font-size: 14px; color: #666;">
              Install this app for a better experience!
            </p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button id="install-pwa-button" style="
              background-color: #ab5f14;
              color: #ffffff;
              font-size: 14px;
              font-weight: bold;
              border: none;
              padding: 8px 12px;
              border-radius: 8px;
              cursor: pointer;
            ">Install</button>
            <button id="close-alert-button" style="
              background-color: #bdbdbd;
              color: #fff;
              font-size: 14px;
              font-weight: bold;
              border: none;
              padding: 8px 12px;
              border-radius: 8px;
              cursor: pointer;
            ">Close</button>
          </div>
        `;

          document.body.appendChild(installAlert);

          const timeout = setTimeout(() => {
            console.log('Install alert timed out after 15 seconds');
            installAlert.remove();
          }, 15000);

          // Handle "Install" button click
          document
            .getElementById('install-pwa-button')
            ?.addEventListener('click', async () => {
              clearTimeout(timeout);
              if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('User choice:', outcome);
                if (outcome === 'accepted') {
                  localStorage.setItem('hasShownA2HS', 'true');
                }
                deferredPrompt = null;
              }
              installAlert.remove();
            });

          // Handle "Close" button click
          document
            .getElementById('close-alert-button')
            ?.addEventListener('click', () => {
              console.log('Install alert closed manually by user');
              clearTimeout(timeout);
              installAlert.remove();
              localStorage.setItem('hasShownA2HS', 'true');
            });
        }
      });

      // Event listener for the shortcut removal
      window.addEventListener('appinstalled', (event) => {
        console.log('App installed', event);
        localStorage.setItem('hasShownA2HS', 'true');
      });
    }
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>