<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buddhaword</title>
  <!-- Meta -->
  <meta name='description' content='The Word of Buddha' />
  <meta name='keywords'
    content='Buddhaword, ຄຳສອນພຣະພຸດທະເຈົ້າ, ທັມມະ, ທັມມະຊາດ, lao, laos, the word of buddha, buddha, nature' />
  <link rel="manifest" href="/manifest.json" />

  <!--  Open Graph Metadata (for social cards) -->
  <meta property='og:title' content='Buddhaword | The Word of Buddha' />
  <meta property='og:description' content='ຄຳສອນພຣະພຸດທະເຈົ້າ' />
  <meta property='og:image' content='https://sutra.web.app/images/logo.png' />
  <meta property='og:type' content='website' />
  <meta property='og:url' content='https://sutra.web.app' />

  <!-- Twitter Meta Tags -->
  <meta name='twitter:card' content='summary_large_image' />
  <meta name='twitter:title' content='Buddhaword' />
  <meta name='twitter:description' content='The Word of Buddha' />
  <meta name='twitter:image' content='https://sutra.web.app/images/logo.png' />


  <!-- Add the favicon -->
  <link rel="icon" type="image/png" href="/images/logo.png" />

  <!-- PWA Support -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#FFAF5D" />
  <meta name="apple-mobile-web-app-title" content="Buddha-Nature" />
  <meta name="theme-color" content="#FFAF5D" />
  <link rel="apple-touch-icon" href="/images/logo.png" />

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Buddhaword",
    "url": "https://sutra.web.app",
    "description": "ຄຳສອນພຣະພຸດທະເຈົ້າ",
    "publisher": {
      "@type": "Organization",
      "name": "Buddhaword",
      "url": "https://sutra.web.app",
      "logo": {
        "@type": "ImageObject",
        "url": "https://sutra.web.app/images/logo.png"
      }
    }
  }
  </script>

  <!-- Scroll View Style Reset -->
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
  <!-- Register Service Worker and Add to Home Screen scripts -->
  <script>
    if ("serviceWorker" in navigator) {
      // Register the service worker
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("/sw.js")
          .then((registration) => {
            console.log(
              "Service Worker registered successfully with scope:",
              registration.scope
            );
          })
          .catch((error) => {
            console.error("Service Worker registration failed:", error);
          });
      });
      let deferredPrompt; // To handle the "Add to Home Screen" prompt
      const hasShownA2HS = localStorage.getItem("hasShownA2HS") === "true";
      if (!hasShownA2HS) {
        // Listen for the "beforeinstallprompt" event
        window.addEventListener("beforeinstallprompt", (event) => {
          console.log("Detected beforeinstallprompt event");
          // Prevent default mini-info bar from appearing
          event.preventDefault();
          deferredPrompt = event; // Save the event for triggering the prompt later
          // Show the custom banner
          const installAlert = document.createElement("div");
          installAlert.style.position = "fixed";
          installAlert.style.bottom = "20px";
          installAlert.style.left = "50%";
          installAlert.style.transform = "translateX(-50%)";
          installAlert.style.backgroundColor = "#ffffff";
          installAlert.style.boxShadow = "0 4px 10px rgba(0, 0, 0, 0.15)";
          installAlert.style.borderRadius = "12px";
          installAlert.style.padding = "15px 20px";
          installAlert.style.zIndex = "1000";
          installAlert.style.display = "flex";
          installAlert.style.alignItems = "center";
          installAlert.style.justifyContent = "space-between";
          installAlert.style.width = "95%";
          installAlert.style.maxWidth = "400px";
          installAlert.style.fontFamily = "Arial, sans-serif";
          // Add content: message, install button, and close button
          installAlert.innerHTML = `
                    <div style="flex: 1;">
                      <p style="margin: 0; font-size: 16px; font-weight: bold; color: #333;">
                        Add to Home Screen
                      </p>
                      <p style="margin: 0; font-size: 14px; color: #666;">
                        Install this app for a better user experience!
                      </p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                      <button id="install-pwa-button" style="
                        background-color: #ab5f14;
                        color: #ffffff;
                        font-size: 14px;
                        font-weight: bold;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: background-color 0.3s;
                      ">Install</button>
                      <button id="close-alert-button" style="
                        background-color: #bdbdbd;
                        color: #fff;
                        font-size: 14px;
                        font-weight: bold;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: background-color 0.3s;
                      ">Close</button>
                    </div>
                  `;
          // Append the alert to the body
          document.body.appendChild(installAlert);
          // Automatically remove the alert after 15 seconds
          const timeout = setTimeout(() => {
            console.log("Install alert timed out after 15 seconds");
            installAlert.remove();
          }, 15000);
          // Handle "Install" button click
          const installButton = document.getElementById("install-pwa-button");
          installButton?.addEventListener("click", async () => {
            clearTimeout(timeout); // Cancel timeout when interacting
            if (deferredPrompt) {
              deferredPrompt.prompt(); // Trigger the install prompt
              const { outcome } = await deferredPrompt.userChoice;
              console.log("User choice:", outcome);
              if (outcome === "accepted") {
                localStorage.setItem("hasShownA2HS", "true"); // Mark as installed
              }
              deferredPrompt = null; // Clear saved prompt after user action
            }
            installAlert.remove(); // Once clicked, remove the alert
          });
          // Handle "Close" button click
          const closeButton = document.getElementById("close-alert-button");
          closeButton?.addEventListener("click", () => {
            console.log("Install alert closed manually by user");
            clearTimeout(timeout); // Cancel timeout
            installAlert.remove(); // Remove alert
            localStorage.setItem("hasShownA2HS", "false"); // Track dismissal
          });
        });
      }
    }
  </script>

  <!-- For Safari iOS -->
  <script>
    // Function to detect if the browser is Safari on iOS
    const isSafariOnIos = () => {
      const userAgent = window.navigator.userAgent.toLowerCase();
      return (
        !/safari/.test(userAgent) // Ensure it's Safari
      );
    };
    // Function to check if the app is already running in standalone mode
    const isInStandaloneMode = () => (
      'standalone' in window.navigator && window.navigator.standalone
    );
    // Function to display the "Add to Home Screen" banner for Safari on iOS
    const showInstallMessageForSafari = () => {
      // Create a custom banner for adding to the home screen
      const addToHomeScreenAlert = document.createElement("div");
      addToHomeScreenAlert.style.cssText = `
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 16px;
            background-color: #333;
            color: #fff;
            text-align: center;
            z-index: 999;
            `;
      addToHomeScreenAlert.id = "addToHomeScreenAlertSafari";
      // Add a button to the banner
      const button = document.createElement("button");
      button.innerHTML = "Add to Home Screen";
      button.style.cssText = `
            background-color: #ab5f14;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            `;
      button.onclick = showSafariInstructions; // Show full instructions when button is clicked
      // Append the button to the banner
      addToHomeScreenAlert.appendChild(button);
      // Append the banner to the body
      document.body.appendChild(addToHomeScreenAlert);
      // Automatically hide the banner after 10 seconds if no interaction occurs
      setTimeout(() => {
        addToHomeScreenAlert.remove();
      }, 10000); // 10 seconds
    };
    // Function to display detailed instructions for adding the app to the home screen
    const showSafariInstructions = () => {
      // Create a modal for the instructions
      const modal = document.createElement("div");
      modal.style.cssText = `
            position: fixed;
            top: 5%;
            left: 50%;
            transform: translate(-50%, 0);
            background-color: white;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto; /* Enable vertical scrolling */
            `;
      // Add content to the modal, including a close button, text, image, and video
      modal.innerHTML = `
            <div style="position: relative; padding-bottom: 15px;"> <!-- Content wrapper -->
          
              <!-- Close button in the top-right corner -->
              <button id="closeModal" style="
                  background: transparent;
                  border: none;
                  position: absolute;
                  top: -25px;
                  right: -20px;
                  font-size: 24px;
                  font-weight: bold;
                  color: #333;
                  cursor: pointer;
                ">&times;</button>
          
              <!-- Heading and Instructions -->
              <h2 style="text-align: center; margin-top: 10px;">How to Add this App to Your Home Screen</h2>
              <p>1. Tap the share icon (the square with the arrow pointing out of it).</p>
              <p>2. Scroll down and select <strong>'Add to Home Screen'</strong>.</p>
          
              <!-- Responsive image above video -->
              <img src="https://buddha-nature-download.vercel.app/assets/iosAddToHomeScreen-CPp5sBzY.jpg" alt="Instructions Image"
                style="
                  width: 100%; 
                  height: auto;  /* Maintain aspect ratio */
                  display: block;
                  margin: 20px 0;
                " />
          
              <!-- Responsive iframe embedding video -->
              <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 20px;">
                <iframe src="https://www.youtube.com/embed/zselTVtT70o" title="YouTube video player"
                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
            </div>
            `;
      // Append the modal to the body
      document.body.appendChild(modal);
      // Close modal logic
      document.querySelector("#closeModal").onclick = function () {
        modal.remove();
      };
    };
    // Add event listener to detect Safari on iOS and show the banner
    window.addEventListener("load", () => {
      if (isSafariOnIos() && !isInStandaloneMode()) {
        showInstallMessageForSafari();
      }
    });
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>