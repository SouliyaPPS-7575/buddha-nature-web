<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buddhaword</title>
  <!-- Meta -->
  <meta name="description" content="The Word of Buddha" />
  <meta name="keywords"
    content="Buddhaword, ຄຳສອນພຣະພຸດທະເຈົ້າ, ທັມມະ, ທັມມະຊາດ, lao, laos, the word of buddha, buddha, nature" />
  <link rel="manifest" href="/manifest.json" />

  <!-- Open Graph Metadata (for social cards) -->
  <meta property="og:title" content="ຄຳສອນພຣະພຸດທະເຈົ້າ" />
  <meta property="og:description" content="Buddhaword | The Word of Buddha" />
  <meta property="og:image" content="https://buddhaword.netlify.app/images/logo_shared.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://buddhaword.netlify.app" />

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Buddhaword" />
  <meta name="twitter:description" content="The Word of Buddha" />
  <meta name="twitter:image" content="https://buddhaword.netlify.app/images/logo_shared.png" />

  <!-- Favicon and PWA Support -->
  <link rel="icon" type="image/png" href="/images/logo.png" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#FFAF5D" />
  <meta name="apple-mobile-web-app-title" content="Buddha-Nature" />
  <meta name="theme-color" content="#FFAF5D" />
  <link rel="apple-touch-icon" href="/images/logo_shared.png" />

  <!-- Structured Data -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Buddhaword",
      "url": "https://buddhaword.netlify.app",
      "description": "ຄຳສອນພຣະພຸດທະເຈົ້າ",
      "publisher": {
        "@type": "Organization",
        "name": "Buddhaword",
        "url": "https://buddhaword.netlify.app",
        "logo": {
          "@type": "ImageObject",
          "url": "https://buddhaword.netlify.app/images/logo_shared.png"
        }
      }
    }
  </script>

  <!-- Scroll View Style Reset -->
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .install-alert {
      z-index: 9999;
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      pointer-events: auto;
    }

    .modal {
      position: fixed;
      z-index: 9999;
    }

    .install-alert *,
    .modal * {
      pointer-events: auto;
    }

    .install-alert-blocker,
    .modal-blocker {
      pointer-events: none;
    }

    .sticky-element {
      position: sticky;
      z-index: 999;
    }
  </style>

  <!-- Service Worker and A2HS Scripts -->
  <script>
    if ("serviceWorker" in navigator) {
      // Register the service worker
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("/sw.js")
          .then((registration) => {
            console.log("Service Worker registered with scope:", registration.scope);
          })
          .catch((error) => {
            console.error("Service Worker registration failed:", error);
          });
      });

      let deferredPrompt;
      const hasShownA2HS = localStorage.getItem("hasShownA2HS") === "true";
      if (!hasShownA2HS) {
        window.addEventListener("beforeinstallprompt", (event) => {
          console.log("Detected beforeinstallprompt event");
          event.preventDefault();
          deferredPrompt = event;
          const installAlert = document.createElement("div");
          installAlert.className = "install-alert";
          installAlert.innerHTML = `
            <div style="flex: 1;">
              <p style="margin: 0; font-size: 16px; font-weight: bold; color: #333;">
                Add to Home Screen
              </p>
              <p style="margin: 0; font-size: 14px; color: #666;">
                Install this app for a better user experience!
              </p>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
              <button id="install-pwa-button" style="
                background-color: #ab5f14;
                color: #ffffff;
                font-size: 14px;
                font-weight: bold;
                border: none;
                padding: 8px 12px;
                border-radius: 8px;
                cursor: pointer;
                transition: background-color 0.3s;
              ">Install</button>
              <button id="close-alert-button" style="
                background-color: #bdbdbd;
                color: #fff;
                font-size: 14px;
                font-weight: bold;
                border: none;
                padding: 8px 12px;
                border-radius: 8px;
                cursor: pointer;
                transition: background-color 0.3s;
              ">Close</button>
            </div>
          `;
          document.body.appendChild(installAlert);
          const timeout = setTimeout(() => {
            console.log("Install alert timed out after 15 seconds");
            installAlert.remove();
          }, 15000);

          const installButton = document.getElementById("install-pwa-button");
          installButton?.addEventListener("click", async () => {
            clearTimeout(timeout);
            if (deferredPrompt) {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              console.log("User choice:", outcome);
              if (outcome === "accepted") {
                localStorage.setItem("hasShownA2HS", "true");
              }
              deferredPrompt = null;
            }
            installAlert.remove();
          });

          const closeButton = document.getElementById("close-alert-button");
          closeButton?.addEventListener("click", () => {
            console.log("Install alert closed manually by user");
            clearTimeout(timeout);
            installAlert.remove();
            localStorage.setItem("hasShownA2HS", "false");
          });
        });
      }

      // Offline fallback message
      window.addEventListener("offline", () => {
        console.log("App is now offline - using cached UI");
      });
      window.addEventListener("online", () => {
        console.log("App is back online");
      });
    }
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>